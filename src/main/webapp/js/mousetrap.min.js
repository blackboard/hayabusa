(function(){function m(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent("on"+b,d)}function A(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);a.shiftKey||(b=b.toLowerCase());return b}return k[a.which]?k[a.which]:B[a.which]?B[a.which]:String.fromCharCode(a.which).toLowerCase()}function u(a){a=a||{};var b=!1,d;for(d in p)a[d]?b=!0:p[d]=0;b||(v=!1)}function C(a,b,d,c,f,g){var e,l,h=[],k=d.type;if(!n[a])return[];"keyup"==k&&w(a)&&(b=[a]);for(e=0;e<n[a].length;++e)if(l=n[a][e],
!(!c&&l.seq&&p[l.seq]!=l.level||k!=l.action||("keypress"!=k||d.metaKey||d.ctrlKey)&&b.sort().join(",")!==l.modifiers.sort().join(","))){var m=c&&l.seq==c&&l.level==g;(!c&&l.combo==f||m)&&n[a].splice(e,1);h.push(l)}return h}function I(a){var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");return b}function x(a,b,d){q.stopCallback(b,b.target||b.srcElement,d)||!1!==a(b,d)||(b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),
b.returnValue=!1,b.cancelBubble=!0)}function r(a,b,d){b=C(a,b,d);var c,f={},g=0,e=!1;for(c=0;c<b.length;++c)b[c].seq&&(g=Math.max(g,b[c].level));for(c=0;c<b.length;++c)b[c].seq?b[c].level==g&&(e=!0,f[b[c].seq]=1,x(b[c].callback,d,b[c].combo)):e||x(b[c].callback,d,b[c].combo);d.type!=v||w(a)||u(f)}function y(a){"number"!==typeof a.which&&(a.which=a.keyCode);var b=A(a);b&&("keyup"==a.type&&z===b?z=!1:q.handleKey(b,I(a),a))}function w(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function J(a,
b,d,c){function f(b){return function(){v=b;++p[a];clearTimeout(D);D=setTimeout(u,1E3)}}function g(b){x(d,b,a);"keyup"!==c&&(z=A(b));setTimeout(u,10)}for(var e=p[a]=0;e<b.length;++e){var h=e+1===b.length?g:f(c||E(b[e+1]).action);F(b[e],h,c,a,e)}}function E(a,b){var d,c,f,g=[];d="+"===a?["+"]:a.split("+");for(f=0;f<d.length;++f)c=d[f],G[c]&&(c=G[c]),b&&("keypress"!=b&&H[c])&&(c=H[c],g.push("shift")),w(c)&&g.push(c);d=c;f=b;if(!f){if(!s){s={};for(var e in k)95<e&&112>e||k.hasOwnProperty(e)&&(s[k[e]]=
e)}f=s[d]?"keydown":"keypress"}"keypress"==f&&g.length&&(f="keydown");return{key:c,modifiers:g,action:f}}function F(a,b,d,c,f){t[a+":"+d]=b;a=a.replace(/\s+/g," ");var g=a.split(" ");1<g.length?J(a,g,b,d):(d=E(a,d),n[d.key]=n[d.key]||[],C(d.key,d.modifiers,{type:d.action},c,a,f),n[d.key][c?"unshift":"push"]({callback:b,modifiers:d.modifiers,action:d.action,seq:c,level:f,combo:a}))}for(var k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",
34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},B={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},H={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},G={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?
"meta":"ctrl"},s,n={},t={},p={},D,z=!1,v=!1,h=1;20>h;++h)k[111+h]="f"+h;for(h=0;9>=h;++h)k[h+96]=h;m(document,"keypress",y);m(document,"keydown",y);m(document,"keyup",y);var q={bind:function(a,b,d){a=a instanceof Array?a:[a];for(var c=0;c<a.length;++c)F(a[c],b,d);return this},unbind:function(a,b){return q.bind(a,function(){},b)},trigger:function(a,b){if(t[a+":"+b])t[a+":"+b]({},a);return this},reset:function(){n={};t={};return this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?
!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.contentEditable&&"true"==b.contentEditable},bindEventsTo:function(a){m(a,"keypress",r);m(a,"keydown",r);m(a,"keyup",r)},handleKey:r};window.Mousetrap=q;"function"===typeof define&&define.amd&&define(q)})();